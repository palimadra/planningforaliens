---
layout: post
title: "How does the new Mac Pro site work?"
blurb: "Apple's Mac Pro page apes the great flash sites of the early aughts, but those smooth animations and transitions are pure HTML5. I poked around the implementation with Chrome's developer tools and reverse engineered the coolest parts.."
author: "sean"
---

<div class="section">
  
  <h2>
    The most expensive Kleenex box cover money can buy
  </h2>
  <p>
    At first the new Mac Pro reminded me of those colored, plastic sheaths your grandma slides over fugly kleenex boxes so they match the decor in her bathroom. But after staring at it for a while it began to look like the dark, sleek, Jobsian future I've been waiting for. Seriously. It looks like a super evil, aerodynamic trash can but I really, really want one.
  </p>
  <p>
    In any case, the product page for the Kleenex box of the century piqued my curiosity. The page behaves like a Flash site from the early 2000's but it's running on pure HTML5 and Javascript. I guess web standards are finally catching up to Flash. (Hooray?)
  </p>
  <p>
    Chrome's developer tools and Firebug revealed about what I expected and one very interesting surprise.
  </p>
  
  <h2>A quick caveat</h2>
  <p>
    I don't know exactly how everything works. The javascript is minimized and really hard to read and they are doing a few things that are new to me. So some of this is just an educated guess. Where I found code I've grabbed screenshots.
  </p>
  
  <h2>How it works in a nutshell</h2>
  <p>
    There is one main video tag on the page. When you scroll or click on one of the navigation links the video is advanced to the section you are about to view using javascript. At the same time a CSS animation is generated and put into a queue to be executed once the video stops. A timer (or an event listener, I didn't figure this out), in the background waits until the video reaches the right spot then starts the animation to show the supporting copy. Finally the last frame of the video is covered up with an identical image -- presumably it looks better than a video frame.
  </p>

  <h2>Everything is absolutely positioned</h2>
  <p>
    The first thing I checked was the markup. I scrolled down to the first spec page, right-clicked right over the video and went to inspect element. 
  </p>
  <figure>
    <a href="/images/macpro/placeholder.png"><img src="/images/macpro/placeholder.png"></img></a>
  </figure>
  <p>
    It's just an empty placeholder. After a little more digging I figured out almost everything on the page is absolutely positioned. That made it challenging to figure out where everything was in the markup, but I figured it out the old fashioned way -- I just read the markup from beginning to end.
  </p>
  <p>
    There are two video tags. One is for the intro video which you see when the page loads. The other video is used to show the Mac Pro swooping around and dancing in the middle of the page.
  </p>
  <figure>
    <a href="/images/macpro/markup-chrome.png"><img src="/images/macpro/markup-chrome.png"></img></a>
  </figure>
  <p>
    Right below the videos is a div called "stillcontainer" which contains a bunch of images. These images are layered over the final frame of each video section. They are all hidden by default and then absolutely positioned over the video frame once it stops.
  </p>
  <figure>
    <a href="/images/macpro/stillcontainer.png"><img src="/images/macpro/stillcontainer.png"></img></a>
  </figure>
  <p>
    Finally there is the "panelcontainer" which is where they stuffed all of the copy for each section.
  </p>
  <figure>
    <a href="/images/macpro/panelcontainer.png"><img src="/images/macpro/panelcontainer.png"></img></a>
  </figure>
  <p>
    Again, each of these sections is hidden until the user scrolls or clicks to a section. The section is absolutely positioned over the video and then revealed via an animation that is coordinated with the video.
  </p>
  

  <h2>Advancing the video using javascript</h2>
  <figure>
    <a href="/images/macpro/videotag.png"><img src="/images/macpro/videotag.png"></img></a>
  </figure>
  <p>
    Apple doesn't use flash so it's no surprise to see the <a href="http://www.html5rocks.com/en/tutorials/video/basics/">video tag</a> here. This is what let's them easily jump around in the video using javascript. 
  </p>
</div>
<div class="section">
  <h2>The markup in Chrome</h2>
  <h2>
    The markup in Firefox.
  </h2>
  <figure>
    <a href="/images/macpro/markup-firefox.png"><img src="/images/macpro/markup-firefox.png"></img></a>
  </figure>
  <p>A canvas tag. Intriguing.</p>
  <p>
    The Chrome markup use a video tag but they used canvas in Firefox. I'll come back to the Firefox markup in a bit, but first let's dissect the Chrome implementation.
  </p>

</div>

{% include sketching.html %}
